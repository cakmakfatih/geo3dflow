(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,a){e.exports=a(29)},22:function(e,t,a){},28:function(e){e.exports={}},29:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(14),c=a.n(o),s=(a(22),a(12)),i=a(3),l=a.n(i),u=a(8),d=a(11),f=a(2),m=a(7),p=a(4),h=a(6),b=function(e){return n.a.createElement("div",{className:"layout",style:{flexDirection:e.flexDirection||"row"}},e.children)},v=a(1),E=function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:360/.011,r=arguments.length>1?arguments[1]:void 0;Object(f.a)(this,e),this.latLonToXY=function(e){return[t.mapWidth/360*(180+e[0]),t.mapHeight/360*(90-e[1])]},this.generateVector=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=t.latLonToXY(e);return{x:r[0]*t.scaler-t.xOffset,y:a,z:r[1]*t.scaler-t.zOffset}},this.mapWidth=1280,this.mapHeight=1280;var n=this.latLonToXY(r);this.scaler=a*this.mapWidth/360,this.xOffset=n[0]*this.scaler,this.zOffset=n[1]*this.scaler},j=a(27)(v),g=function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n)))).loadProject=function(e){a.project=Object.assign({},e,{objects:e.objects.map(function(e){return Object.assign({},e)})}),a.setOffsets([a.project.coordinates.lat,a.project.coordinates.lon]),a.project.objects.forEach(function(e){a.processData(e)})},a.processData=function(e){e.data.features.forEach(function(t){switch(e.type3d){case"3D_POLYGON":a.add3DPolygon(t,e.id,e.settings)}})},a}return Object(h.a)(t,e),t}(function(){function e(){var t=this;Object(f.a)(this,e),this.initBuilder=function(e){t.container=e,t.scene=new v.Scene,t.camera=new v.PerspectiveCamera(90,t.container.getBoundingClientRect().width/t.container.getBoundingClientRect().height,.1,1e4),t.renderer=new v.WebGLRenderer({antialias:!0}),t.renderer.shadowMap.enabled=!0,t.renderer.setSize(t.container.getBoundingClientRect().width,t.container.getBoundingClientRect().height),t.container.appendChild(t.renderer.domElement),window.addEventListener("resize",function(){t.renderer.setSize(t.container.getBoundingClientRect().width,t.container.getBoundingClientRect().height),t.camera.aspect=t.container.offsetWidth/t.container.getBoundingClientRect().height,t.camera.updateProjectionMatrix()}),t.controls=new j(t.camera,t.renderer.domElement),t.controls.maxPolarAngle=30,t.controls.maxPolarAngle=70,t.controls.minDistance=10,t.controls.maxDistance=2e3,t.addSkybox(),t.viewLoop()},this.viewLoop=function(){requestAnimationFrame(t.viewLoop),t.update(),t.render()},this.render=function(){t.renderer.render(t.scene,t.camera)},this.update=function(){},this.addSkybox=function(){var e=new v.BoxGeometry(1e4,1e4,1e4),a=new v.MeshBasicMaterial({side:v.DoubleSide,color:14540253}),r=new v.Mesh(e,a);t.scene.add(r)},this.setOffsets=function(e){t.project.coordinates=e,t.vectorGenerator=new E(void 0,e),t.camera.position.set(1e3,1e3,1e3),t.camera.lookAt(0,0,0),t.addGround(e)},this.add3DPolygon=function(e,a,r){var n=new v.MeshBasicMaterial({color:parseInt(r.material.color,16)}),o=new v.MeshBasicMaterial({color:parseInt(r.material.sideColor,16),side:v.DoubleSide}),c=new v.Shape,s=t.vectorGenerator.generateVector(e.geometry.coordinates[0][0][0]);c.moveTo(s.x,-s.z),e.geometry.coordinates.forEach(function(e){e.forEach(function(e){e.slice(1).forEach(function(e){var a=t.vectorGenerator.generateVector(e);c.lineTo(a.x,-a.z)})})});var i=new v.ExtrudeBufferGeometry(c,r.extrude),l=new v.Mesh(i,[n,o]);l.rotation.x+=-Math.PI/2,l.position.setY(r.extrude.depth/2),t.project.objects.find(function(e){return e.id===a}).item=l,t.scene.add(l)}}return Object(d.a)(e,[{key:"addGround",value:function(e){var t=new v.PlaneGeometry(1e4,1e4,32),a=new v.TextureLoader,r="https://api.mapbox.com/styles/v1/mapbox/streets-v10/static/".concat(e[0],",").concat(e[1],",15.0,0,0/1280x1280?access_token=pk.eyJ1IjoiY2FrbWFrZmF0aWgiLCJhIjoiY2pxcGk1d3ZrMDFwYjQ5bzFqNncyYjl2NyJ9.MtGJZ74Cu-6R7K52rFrNeQ"),n=a.load(r);n.anisotropy=this.renderer.capabilities.getMaxAnisotropy(),n.minFilter=v.LinearFilter;var o=new v.MeshBasicMaterial({map:n,side:v.DoubleSide}),c=new v.Mesh(t,o);c.rotation.x-=Math.PI/2,this.scene.add(c)}}]),e}()),N=a(9),O=a(15),w=function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n))),Error.captureStackTrace(Object(N.a)(Object(N.a)(a)),t),a}return Object(h.a)(t,e),t}(Object(O.a)(Error)),y=(a(28),a(5)),x=function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).componentWillMount=function(){a.project={},a.project.projectName="",a.project.projectDescription="",a.setState({menu:"START",activeLevel:0,objects:[]})},a.componentDidMount=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),a.createProject=function(){var e=a.guid(),t=a.state.objects;if(a.project=Object(s.a)({},a.project,{id:e}),!(t.length>0&&a.project.projectName.length>0))throw new Error("You can't create a project without providing a valid venue data and a name.");a.changeMenu("PROJECT_MENU");var r=t.find(function(e){return"3D_POLYGON"===e.type3d}).data.features.find(function(e){return"undefined"!==typeof e.properties.DISPLAY_XY}).properties.DISPLAY_XY.coordinates;a.project.coordinates={lat:r[0],lon:r[1]},a.openProject(a.projectData)},a.changeMenu=function(e){a.lastMenu=a.state.menu,a.setState({menu:e})},a.renderMenu=function(){switch(a.state.menu){case"START":return a.startMenu();case"NEW_MODEL_1":return a.newModel1();case"MANUAL_GEOJSON":return a.manualGeoJSON();case"PROJECT_MENU":return a.projectMenu();case"ADD_ONE":return a.addOne()}},a.renderLevels=function(){var e=a.state.activeLevel;return n.a.createElement("section",{className:"levels"},Object.keys(a.projectLevels).map(function(t){return n.a.createElement("div",{className:e===parseInt(t,10)?"active":"",key:t},t)}))},a.openProject=function(){var e=Object(u.a)(l.a.mark(function e(t){var r,n,o,c,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projectName,n=t.projectDescription,o=t.id,c=t.objects,s=t.coordinates,e.next=3,a.setState({objects:c});case 3:a.project={projectName:r,projectDescription:n,coordinates:s,id:o},a.initBuilder(a.refs["3d-view-container"]),a.loadProject(a.projectData);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.getGeo3D=function(){var e=Object(u.a)(l.a.mark(function e(t){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 0!==a.state.objects.length&&a.setState({objects:[]}),e.next=4,a.readFile(t,"geo3d");case 4:"error"===(r=e.sent).status?a.handleError(r.error):a.openProject(r.data);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.getGeoJSON=function(){var e=Object(u.a)(l.a.mark(function e(t){var r,n,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.state.objects,e.next=3,a.readFile(t,"geojson");case 3:"error"===(n=e.sent).status?a.handleError(n.error):(o=a.guid(),r.push({data:n.data,type3d:"3D_POLYGON",name:"VENUE",id:o,level:0,settings:{extrude:y.extrudeSettings,material:{sideColor:y.sideColor,color:y.defaultColor}}}),console.log(r));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.getVenue=function(){var e=Object(u.a)(l.a.mark(function e(t){var r,n,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(r=a.state.objects).length){e.next=4;break}return e.next=4,a.setState({objects:[]});case 4:return e.next=6,a.readFile(t,"geojson");case 6:if("success"!==(n=e.sent).status){e.next=17;break}if("success"!==(o=a.isVenue(n.data)).status){e.next=14;break}c=a.guid(),r.push({data:n.data,type3d:"3D_POLYGON",name:"VENUE",id:c,level:0,settings:{extrude:y.extrudeSettings,material:{sideColor:y.sideColor,color:y.defaultColor}}}),e.next=15;break;case 14:throw new Error(o.error);case 15:e.next=18;break;case 17:throw new Error(n.error);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.validateManualData=function(e){var t=a.state.objects,r=a.refs["manual-geojson"].value;try{var n=JSON.parse(r),o=a.isVenue(n);if("success"===o.status){var c=a.guid();t.push({data:n,type3d:"3D_POLYGON",name:"VENUE",id:c,level:0,settings:{extrude:y.extrudeSettings,material:{sideColor:y.sideColor,color:y.defaultColor}}}),a.setState({menu:"NEW_MODEL_1",objects:t})}else a.handleError(o.error)}catch(s){a.handleError(s)}},a.startMenu=function(){return n.a.createElement("aside",{className:"aside"},n.a.createElement("section",{className:"aside-top"},n.a.createElement("div",{className:"form-group"},n.a.createElement("button",{className:"btn-default btn-bordered",onClick:function(){return a.changeMenu("NEW_MODEL_1")}},n.a.createElement("i",{className:"fas fa-plus"}),"NEW")),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"up-v",className:"btn-default btn-bordered"},n.a.createElement("i",{className:"far fa-folder-open"}),"OPEN"),n.a.createElement("input",{type:"file",accept:".geo3d",id:"up-v",className:"upload-default",onChange:a.getGeo3D}))))},a.newModel1=function(){return n.a.createElement("aside",{className:"aside"},n.a.createElement("section",{className:"aside-top"},n.a.createElement("div",{className:"btn-back",onClick:function(){a.project.projectName="",a.project.projectDescription="",a.setState({menu:"START",objects:[]})}},n.a.createElement("i",{className:"fas fa-chevron-left"}),n.a.createElement("span",null,"BACK")),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Project Name (*)"),n.a.createElement("input",{type:"text",className:"inp-default",onChange:function(e){return a.project.projectName=e.target.value}})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Project Description"),n.a.createElement("textarea",{rows:5,className:"inp-default",onChange:function(e){return a.project.projectDescription=e.target.value}})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"up-v",className:"btn-default"},n.a.createElement("i",{className:"fas fa-folder-open"}),"Venue GeoJSON"),n.a.createElement("input",{type:"file",accept:".geojson",id:"up-v",className:"upload-default",onChange:a.getVenue})),n.a.createElement("div",{className:"form-group"},n.a.createElement("span",{className:"link-span",onClick:function(){return a.setState({menu:"MANUAL_GEOJSON"})}},"Alternatively, you can manually enter GeoJSON data"))),n.a.createElement("button",{className:"btn-default btn-bordered",onClick:function(){return a.createProject()}},"NEXT"))},a.manualGeoJSON=function(){return n.a.createElement("aside",{className:"aside"},n.a.createElement("section",{className:"aside-top"},n.a.createElement("div",{className:"btn-back",onClick:function(){return a.setState({menu:"NEW_MODEL_1"})}},n.a.createElement("i",{className:"fas fa-chevron-left"}),n.a.createElement("span",null,"BACK")),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Venue GeoJSON"),n.a.createElement("textarea",{rows:12,className:"inp-default",ref:"manual-geojson"}))),n.a.createElement("button",{className:"btn-default",onClick:a.validateEntered},"SAVE"))},a.projectMenu=function(){return n.a.createElement("aside",{className:"aside"},n.a.createElement("section",{className:"aside-top"},n.a.createElement("div",{className:"form-group"},n.a.createElement("button",{className:"btn-default",onClick:function(){return a.changeMenu("ADD_ONE")}},n.a.createElement("i",{className:"fas fa-plus"}),"ADD")),n.a.createElement("div",{className:"form-group"},n.a.createElement("button",{className:"btn-default"},n.a.createElement("i",{className:"fas fa-pen"}),"EDIT"))),n.a.createElement("button",{className:"btn-default",onClick:function(){return window.location.reload()}},"QUIT"))},a.addOne=function(){return n.a.createElement("aside",{className:"aside"},n.a.createElement("section",{className:"aside-top"},n.a.createElement("div",{className:"btn-back",onClick:function(){return a.setState({menu:a.lastMenu})}},n.a.createElement("i",{className:"fas fa-chevron-left"}),n.a.createElement("span",null,"BACK")),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Name (*)"),n.a.createElement("input",{type:"text",className:"inp-default",onChange:function(e){return a.project.projectName=e.target.value}})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Level (*)"),n.a.createElement("input",{type:"text",className:"inp-default",onChange:function(e){return a.project.projectName=e.target.value}})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"",className:"label-default"},"Type (*)"),n.a.createElement("select",{className:"inp-default"},n.a.createElement("option",{value:""},"WALL"),n.a.createElement("option",{value:""},"LEVELS"),n.a.createElement("option",{value:""},"GROUND"),n.a.createElement("option",{value:""},"OBJECT"),n.a.createElement("option",{value:""},"LINE"),n.a.createElement("option",{value:""},"PATH"))),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"up-v",className:"btn-default"},n.a.createElement("i",{className:"fas fa-upload"}),"GeoJSON"),n.a.createElement("input",{type:"file",accept:".geojson",id:"up-v",className:"upload-default",onChange:a.getGeoJSON})),n.a.createElement("div",{className:"form-group"},n.a.createElement("span",{className:"link-span",onClick:function(){return a.setState({menu:"MANUAL_GEOJSON"})}},"Alternatively, you can manually enter GeoJSON data"))),n.a.createElement("button",{className:"btn-default btn-bordered",onClick:function(){return a.createProject()}},n.a.createElement("i",{className:"fas fa-plus"}),"ADD"))},a.render=function(){return n.a.createElement(b,{flexDirection:"row"},a.renderMenu(),a.renderLevels(),n.a.createElement("div",{ref:"3d-view-container",id:"geo3d-view-container"}))},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"projectData",get:function(){return Object(s.a)({},this.project,{objects:this.state.objects})}},{key:"projectLevels",get:function(){var e={};return this.state.objects.sort(function(e,t){return e.level>t.level?1:-1}).forEach(function(t){return e[t.level]=!0}),e}}]),t}(function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var n=function(e){function t(){var e,r;Object(f.a)(this,t);for(var n=arguments.length,c=new Array(n),s=0;s<n;s++)c[s]=arguments[s];return r=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(c))),a.forEach(function(e){o(Object(N.a)(Object(N.a)(r)),new e)}),r}return Object(h.a)(t,e),t}(e),o=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach(function(a){a.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})};return a.forEach(function(e){o(n.prototype,e.prototype),o(n,e)}),n}(function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(r.Component),function e(){var t=this;Object(f.a)(this,e),this.sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},this.readFile=function(){var e=Object(u.a)(l.a.mark(function e(a,r){var n,o,c,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==a.target.files.length){e.next=19;break}if(n=a.target.files[0],"undefined"===typeof(o=/[.]/.exec(n.name)?/[^.]+$/.exec(n.name):void 0)){e.next=16;break}if((c=o[0])!==r&&"json"!==c){e.next=13;break}return t.reader.readAsText(n),e.next=9,t.fetchData();case 9:return s=e.sent,e.abrupt("return",s);case 13:return e.abrupt("return",{status:"error",error:{code:501,message:"Unexpected file type."}});case 14:e.next=17;break;case 16:return e.abrupt("return",{status:"error",error:{code:502,message:"Unexpected error."}});case 17:e.next=20;break;case 19:return e.abrupt("return",{status:"error",error:{code:503,message:"Unexpected file type."}});case 20:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),this.readParser=function(e){try{var a=JSON.parse(e.target.result);t.lastReadFile={status:"success",data:a}}catch(e){return{status:"error",error:{code:504,message:"Parsing error."}}}},this.fetchData=Object(u.a)(l.a.mark(function e(){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof t.lastReadFile){e.next=6;break}return a=t.lastReadFile,t.lastReadFile=void 0,e.abrupt("return",a);case 6:return e.next=8,t.sleep(300);case 8:return e.abrupt("return",t.fetchData());case 9:case"end":return e.stop()}},e,this)})),this.isGeo3D=function(e){return"undefined"!==typeof e.coordinates&&"undefined"!==typeof e.id&&"undefined"!==typeof e.objects&&"undefined"!==typeof e.projectName&&"undefined"!==typeof e.projectDescription?{status:"success"}:{status:"error",error:{code:505,message:"Unexpected format in the provided data."}}},this.isVenue=function(e){return"undefined"!==typeof e.features&&"undefined"!==typeof e.features[0]?"undefined"!==typeof e.features[0].properties?"undefined"!==typeof e.features[0].properties.DISPLAY_XY&&"undefined"!==typeof e.features[0].properties.DISPLAY_XY.coordinates?{status:"success"}:{status:"error",error:{code:506,message:"Venue file's {features} array must contain {DISPLAY_XY} in it's {properties}."}}:{status:"error",error:{code:507,message:"File is formatted in a bad shape."}}:{status:"error",error:{code:508,message:"Unexpected format in the provided data."}}},this.saveProjectLocal=function(e){var t="".concat(e.projectName,".geo3d"),a=new File([JSON.stringify(e,null,2)],"".concat(t),{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,t);else{var r=document.createElement("a"),n=URL.createObjectURL(a);r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r),window.URL.revokeObjectURL(n)},0)}},this.reader=new FileReader,this.reader.onload=this.readParser},function e(){Object(f.a)(this,e),this.guid=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},g,function e(){Object(f.a)(this,e),this.handleError=function(e){var t=e.message,a=e.code;throw a>=500&&a<600?new w(t,a):new Error("Unexpected error.")}})),S=function(){return n.a.createElement(x,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},5:function(e){e.exports={defaultColor:"0xffffff",sideColor:"0xff0000",extrudeSettings:{steps:2,depth:8,bevelEnabled:!0,bevelThickness:1,bevelSize:1,bevelSegments:1}}}},[[16,2,1]]]);
//# sourceMappingURL=main.63358651.chunk.js.map